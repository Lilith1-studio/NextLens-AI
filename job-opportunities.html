
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Opportunities</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        scroll-behavior: smooth;
      }
      .hamburger-menu-links.closed {
        transform: translateX(100%);
      }
      .hamburger-menu-links {
        transition: transform 0.3s ease-in-out;
      }
    </style>
</head>
<body class="flex flex-col bg-white">
<!-- Header -->
<header class="bg-white sticky top-0 z-50 shadow-sm">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <!-- Logo -->
    <a href="index.html" class="flex items-center space-x-2">
      <span class="font-bold text-lg text-[#283E4A]">NextLens AI</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center space-x-6">
      <a href="my-network.html" class="text-gray-600 hover:text-blue-500">My Network</a>
      <a href="my-notifications.html" class="text-gray-600 hover:text-blue-500">My Notifications</a>
      <a href="job-opportunities.html" class="text-gray-600 hover:text-blue-500">Job Opportunities</a>
      <a href="privacy.html" class="text-gray-600 hover:text-blue-500">Privacy & Policy</a>
      <a href="contact.html" class="text-gray-600 hover:text-blue-500">Contact</a>
      <button id="sign-up-btn-desktop"
        class="px-5 py-2 rounded-full font-medium text-white bg-blue-600 hover:bg-blue-700 shadow-md">
        Sign Up
      </button>
    </nav>

    <!-- Mobile Hamburger Button -->
    <button id="open-hamburger-menu-btn" class="md:hidden">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M4 6h16M4 12h16m-7 6h7" />
      </svg>
    </button>
  </div>
</header>
    <script>
        // Authentication check - runs when page loads
        const API_BASE = "/api";
        
        async function checkAuthentication() {
            const token = localStorage.getItem("token");
            console.log("Checking authentication, token exists:", !!token);
            
            if (!token) {
                console.log("No token found, redirecting to login");
                window.location.href = "/login.html";
                return false;
            }
            
            try {
                console.log("Making auth check request...");
                const response = await fetch(`${API_BASE}/check-status`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ token })
                });
                
                const data = await response.json();
                console.log("Auth check response:", data);
                
                if (!data.authenticated) {
                    console.log("User not authenticated, clearing storage and redirecting");
                    localStorage.removeItem("token");
                    localStorage.removeItem("email");
                    localStorage.removeItem("userRole");
                    window.location.href = "/login.html";
                    return false;
                } else {
                    console.log("User authenticated successfully");
                    // Store user data for use in the page
                    localStorage.setItem("currentUser", JSON.stringify(data.user));
                    return true;
                }
            } catch (error) {
                console.error("Auth check failed:", error);
                window.location.href = "/login.html";
                return false;
            }
        }
        
        // Run authentication check when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAuthentication();
        });
        
        // Also run immediately in case DOM is already loaded
        if (document.readyState === 'loading') {
            // DOM is still loading
        } else {
            // DOM is already loaded
            checkAuthentication();
        }
    </script>

    <!-- Main content container -->
    <div class="flex-1 flex flex-col items-center p-4 bg-white">
        <!-- Main page container -->
        <div class="bg-white rounded-3xl shadow-xl w-full max-w-7xl flex flex-col lg:flex-row min-h-[80vh] overflow-hidden">

            <!-- Main content area -->
            <div class="flex-1 flex flex-col p-6 overflow-hidden">
                <!-- Post a job button section -->
                <div class="pb-6 border-b border-gray-200 lg:border-none lg:pb-0">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-800">Job Postings</h2>
                        <button id="post-job-btn" class="bg-blue-500 text-white px-4 py-2 rounded-xl font-medium shadow-md hover:bg-blue-600 transition-colors">Post a job</button>
                    </div>
                </div>

                <!-- Main content grid -->
                <div class="flex-1 flex flex-col lg:flex-row mt-6 lg:mt-0 overflow-y-auto lg:overflow-hidden">
                    <!-- Central content section: search and job listings -->
                    <div class="flex-1 flex flex-col overflow-y-auto job-listings-container">
                        <!-- Search bar section -->
                        <div class="bg-gray-100 rounded-2xl p-6 mb-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Let's find your dream job</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="relative">
                                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                    <input type="text" id="job-title-input" placeholder="Job Title, Company, or Anything" class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-gray-800 placeholder-gray-500">
                                </div>

                                <!-- Updated Location Dropdown and Conditional Input -->
                                <div class="col-span-1">
                                    <!-- Location Type Dropdown with its own icon container -->
                                    <div class="relative">
                                        <i class="fas fa-map-marker-alt absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                        <select id="location-type-dropdown" class="w-full p-3 pl-12 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-gray-800">
                                            <option value="">All Locations</option>
                                            <option value="Remote">Remote</option>
                                            <option value="On-site">On-site</option>
                                            <option value="Hybrid">Hybrid</option>
                                        </select>
                                    </div>
                                    <!-- Conditional Location Input with its own icon container -->
                                    <div id="location-input-container" class="relative mt-2 hidden">
                                        <i class="fas fa-map-marker-alt absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                        <input type="text" id="location-input" placeholder="Country/City" class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-gray-800 placeholder-gray-500">
                                    </div>
                                </div>

                                <div class="relative">
                                    <i class="fas fa-dollar-sign absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                    <input type="text" id="salary-input" placeholder="Salary Range" class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-gray-800 placeholder-gray-500">
                                </div>
                            </div>

                            <!-- Other Filter Dropdowns -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                <!-- Position Type Filter -->
                                <div class="mb-2 md:mb-0">
                                    <h4 class="text-sm font-medium text-black mb-1">Position Type</h4>
                                    <select id="position-type-dropdown" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                                        <option value="">All</option>
                                        <option value="Full-Time">Full-Time</option>
                                        <option value="Part-Time">Part-Time</option>
                                        <option value="Internship">Internship</option>
                                        <option value="Freelance">Freelance</option>
                                        <option value="Contract">Contract</option>
                                    </select>
                                </div>

                                <!-- Experience Level Filter -->
                                <div class="mb-2 md:mb-0">
                                    <h4 class="text-sm font-medium text-black mb-1">Experience Level</h4>
    <select id="experience-level-dropdown" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                                        <option value="">All</option>
                                        <option value="Entry-Level">Entry-Level</option>
                                        <option value="Mid-Level">Mid-Level</option>
                                        <option value="Senior">Senior</option>
                                        <option value="Executive">Executive</option>
                                    </select>
                                </div>

                                <!-- Industry Filter -->
                                <div class="mb-2 md:mb-0">
                                    <h4 class="text-sm font-medium text-black mb-1">Industry</h4>
                                    <select id="industry-dropdown" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                                        <option value="">All</option>
                                        <option value="Accounting & Auditing">Accounting & Auditing</option>
                                        <option value="Advertising & Marketing">Advertising & Marketing</option>
                                        <option value="Aerospace & Defense">Aerospace & Defense</option>
                                        <option value="AgriTech & Farming Technology">AgriTech & Farming Technology</option>
                                        <option value="Agricultural Supply & Equipment">Agricultural Supply & Equipment</option>
                                        <option value="AI & Robotics Startups">AI & Robotics Startups</option>
                                        <option value="Airlines & Aviation Services">Airlines & Aviation Services</option>
                                        <option value="Accessories & Jewelry">Accessories & Jewelry</option>
                                        <option value="Architecture & Urban Planning">Architecture & Urban Planning</option>
                                        <option value="Artificial Intelligence & Machine Learning">Artificial Intelligence & Machine Learning</option>
                                        <option value="Asset Management">Asset Management</option>
                                        <option value="Automotive">Automotive</option>
                                        <option value="Automotive Parts & Accessories">Automotive Parts & Accessories</option>
                                        <option value="Automotive Repair & Maintenance">Automotive Repair & Maintenance</option>
                                        <option value="Autonomous Vehicles">Autonomous Vehicles</option>
                                        <option value="Banking">Banking</option>
                                        <option value="Beauty & Cosmetics">Beauty & Cosmetics</option>
                                        <option value="Beauty & Personal Care">Beauty & Personal Care</option>
                                        <option value="Biotechnology">Biotechnology</option>
                                        <option value="Blockchain & Cryptocurrency">Blockchain & Cryptocurrency</option>
                                        <option value="Car Manufacturing">Car Manufacturing</option>
                                        <option value="Car Rentals & Ride-Hailing">Car Rentals & Ride-Hailing</option>
                                        <option value="Carbon & Climate Solutions">Carbon & Climate Solutions</option>
                                        <option value="Chemicals & Plastics">Chemicals & Plastics</option>
                                        <option value="Civil Engineering & Construction">Civil Engineering & Construction</option>
                                        <option value="Cloud Computing">Cloud Computing</option>
                                        <option value="Clothing & Apparel">Clothing & Apparel</option>
                                        <option value="Community Services">Community Services</option>
                                        <option value="Computer Vision">Computer Vision</option>
                                        <option value="Corporate Banking">Corporate Banking</option>
                                        <option value="Corporate Law">Corporate Law</option>
                                        <option value="Corporate Training & Development">Corporate Training & Development</option>
                                        <option value="Courier & Delivery Services">Courier & Delivery Services</option>
                                        <option value="Crop Production">Crop Production</option>
                                        <option value="Cruise Lines">Cruise Lines</option>
                                        <option value="Cybersecurity">Cybersecurity</option>
                                        <option value="Data Science">Data Science</option>
                                        <option value="Defense & Security">Defense & Security</option>
                                        <option value="Digital Banking">Digital Banking</option>
                                        <option value="Digital Media & Streaming">Digital Media & Streaming</option>
                                        <option value="Drone Services">Drone Services</option>
                                        <option value="EdTech Platforms">EdTech Platforms</option>
                                        <option value="Education & Community Services">Education & Community Services</option>
                                        <option value="E-Learning & Online Courses">E-Learning & Online Courses</option>
                                        <option value="Electric Vehicles (EVs)">Electric Vehicles (EVs)</option>
                                        <option value="Electricity & Power Distribution">Electricity & Power Distribution</option>
                                        <option value="Electronics & Electrical Equipment">Electronics & Electrical Equipment</option>
                                        <option value="Energy Consulting & Services">Energy Consulting & Services</option>
                                        <option value="Environmental Consulting">Environmental Consulting</option>
                                        <option value="Environmental Organizations">Environmental Organizations</option>
                                        <option value="Event & Conference Centers">Event & Conference Centers</option>
                                        <option value="Event Management">Event Management</option>
                                        <option value="Fashion & Apparel">Fashion & Apparel</option>
                                        <option value="Film & Television">Film & Television</option>
                                        <option value="Fintech">Fintech</option>
                                        <option value="Fisheries & Aquaculture">Fisheries & Aquaculture</option>
                                        <option value="Fitness & Rehabilitation">Fitness & Rehabilitation</option>
                                        <option value="Fitness Centers & Gyms">Fitness Centers & Gyms</option>
                                        <option value="Food & Beverage Manufacturing">Food & Beverage Manufacturing</option>
                                        <option value="Food Processing & Packaging">Food Processing & Packaging</option>
                                        <option value="Game Development">Game Development</option>
                                        <option value="Gaming & eSports">Gaming & eSports</option>
     <option value="Geothermal">Geothermal</option>
                                        <option value="Green Tech & Innovation">Green Tech & Innovation</option>
                                        <option value="Grocery & Food Delivery">Grocery & Food Delivery</option>
                                        <option value="Hardware & Networking">Hardware & Networking</option>
                                        <option value="Health Insurance">Health Insurance</option>
                                        <option value="Health IT">Health IT</option>
                                        <option value="Hedge Funds">Hedge Funds</option>
                                        <option value="Higher Education">Higher Education</option>
                                        <option value="Home & Furniture">Home & Furniture</option>
                                        <option value="Hospitals & Clinics">Hospitals & Clinics</option>
                                        <option value="Hydro">Hydro</option>
                                        <option value="Industrial Engineering">Industrial Engineering</option>
                                        <option value="Infrastructure & Urban Planning">Infrastructure & Urban Planning</option>
                                        <option value="Insurance">Insurance</option>
                                        <option value="Interior Design & Landscaping">Interior Design & Landscaping</option>
                                        <option value="International Development">International Development</option>
                                        <option value="Intellectual Property">Intellectual Property</option>
                                        <option value="Investments">Investments</option>
                                        <option value="IT Consulting">IT Consulting</option>
                                        <option value="IT Services">IT Services</option>
                                        <option value="K-12 Education">K-12 Education</option>
                                        <option value="Law Firms">Law Firms</option>
                                        <option value="Leisure & Recreation">Leisure & Recreation</option>
                                        <option value="Life Insurance">Life Insurance</option>
                                        <option value="Livestock & Poultry">Livestock & Poultry</option>
                                        <option value="Luxury Fashion">Luxury Fashion</option>
                                        <option value="Luxury Goods">Luxury Goods</option>
                                        <option value="Machinery & Heavy Equipment">Machinery & Heavy Equipment</option>
                                        <option value="Managed Services">Managed Services</option>
                                        <option value="Management Consulting">Management Consulting</option>
                                        <option value="Medical Devices">Medical Devices</option>
                                        <option value="Mental Health Services">Mental Health Services</option>
                                        <option value="Metaverse & Virtual Reality">Metaverse & Virtual Reality</option>
                                        <option value="Mobile App Development">Mobile App Development</option>
                                        <option value="Music & Audio">Music & Audio</option>
                                        <option value="Natural Language Processing">Natural Language Processing</option>
                                        <option value="NGOs & Charities">NGOs & Charities</option>
                                        <option value="NFTs & Digital Assets">NFTs & Digital Assets</option>
                                        <option value="News Media">News Media</option>
                                        <option value="Nuclear Energy">Nuclear Energy</option>
                                        <option value="Nutrition & Wellness">Nutrition & Wellness</option>
                                        <option value="Oil & Gas">Oil & Gas</option>
                                        <option value="Online Marketplaces">Online Marketplaces</option>
                                        <option value="Organic Farming">Organic Farming</option>
                                        <option value="Outdoor Recreation">Outdoor Recreation</option>
                                        <option value="Payment Processing">Payment Processing</option>
                                        <option value="Personal Care">Personal Care</option>
                                        <option value="Pharmaceuticals">Pharmaceuticals</option>
                                        <option value="Policy Research & Think Tanks">Policy Research & Think Tanks</option>
                                        <option value="Private Equity">Private Equity</option>
                                        <option value="Professional Sports Teams">Professional Sports Teams</option>
                                        <option value="Property & Casualty">Property & Casualty</option>
                                        <option value="Property Management">Property Management</option>
                                        <option value="Public Administration">Public Administration</option>
                                        <option value="Public Health">Public Health</option>
                                        <option value="Publishing">Publishing</option>
                                        <option value="Railways & Public Transit">Railways & Public Transit</option>
                                        <option value="Real Estate Investment">Real Estate Investment</option>
                                        <option value="Recycling & Upcycling">Recycling & Upcycling</option>
                                        <option value="Renewable Energy">Renewable Energy</option>
                                        <option value="Residential Real Estate">Residential Real Estate</option>
                                        <option value="Restaurants & Food Services">Restaurants & Food Services</option>
                                        <option value="Retail Banking">Retail Banking</option>
                                        <option value="Ride-Sharing & Mobility Services">Ride-Sharing & Mobility Services</option>
                                        <option value="Robotics & Automation">Robotics & Automation</option>
                                        <option value="SaaS (Software as a Service)">SaaS (Software as a Service)</option>
                                        <option value="Shipping & Freight">Shipping & Freight</option>
                                        <option value="Smart Home Technology">Smart Home Technology</option>
                                        <option value="Social Enterprises">Social Enterprises</option>
                                        <option value="Software Development">Software Development</option>
                                        <option value="Solar">Solar</option>
                                        <option value="Space & Aerospace Innovation">Space & Aerospace Innovation</option>
                                        <option value="Sports Equipment Manufacturing">Sports Equipment Manufacturing</option>
      <option value="Sports Media & Broadcasting">Sports Media & Broadcasting</option>
                                        <option value="Strategy & Business Advisory">Strategy & Business Advisory</option>
                                        <option value="Supply Chain Management">Supply Chain Management</option>
                                        <option value="Taxation & Compliance">Taxation & Compliance</option>
                                        <option value="Tax & Compliance Consulting">Tax & Compliance Consulting</option>
                                        <option value="Technical Support">Technical Support</option>
                                        <option value="Telemedicine">Telemedicine</option>
                                        <option value="Textiles & Apparel">Textiles & Apparel</option>
                                        <option value="Travel Agencies & Tour Operators">Travel Agencies & Tour Operators</option>
                                        <option value="Vocational Training">Vocational Training</option>
                                        <option value="Warehousing & Inventory Management">Warehousing & Inventory Management</option>
                                        <option value="Water & Waste Management">Water & Waste Management</option>
                                        <option value="Web Development">Web Development</option>
                                        <option value="Wind">Wind</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Combined Search and Reset Buttons -->
                            <!-- The button container is now a flex row on medium and larger screens -->
                            <div class="flex flex-col md:flex-row md:justify-center md:items-center mt-4 space-y-2 md:space-y-0 md:space-x-4">
                                <!-- Search Button -->
                                <button id="search-btn" class="w-full md:w-auto px-4 py-2 bg-blue-500 text-white rounded-lg font-medium shadow-md hover:bg-blue-600 transition-colors">Search</button>
                                <!-- Reset Button is now blue but with an outlined style -->
                                <button id="reset-btn" class="w-full md:w-auto px-4 py-2 bg-transparent text-blue-500 border border-blue-500 rounded-lg font-medium shadow-md hover:bg-blue-500 hover:text-white transition-colors">Reset</button>
                            </div>
                        </div>

                        <!-- Job Listings Section -->
                        <div id="job-listings" class="space-y-4">
                            <!-- Job cards will be injected here by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Mobile Hamburger Menu -->
<div id="hamburger-menu-links"
  class="hamburger-menu-links closed fixed top-0 right-0 h-full w-2/3 max-w-sm bg-white/80 backdrop-blur-md shadow-lg z-40 p-6 pt-20 overflow-y-auto md:hidden">
  <button id="close-hamburger-menu-btn"
    class="absolute top-6 right-6 text-gray-400 hover:text-gray-600">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
      viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>
  <nav class="flex flex-col space-y-4 text-lg text-gray-800">
    <a href="my-network.html" class="hover:text-gray-600">My Network</a>
    <a href="my-notifications.html" class="hover:text-gray-600">My Notifications</a>
    <a href="job-opportunities.html" class="hover:text-gray-600">Job Opportunities</a>
    <a href="privacy.html" class="hover:text-gray-600">Privacy & Policy</a>
    <a href="contact.html" class="hover:text-gray-600">Contact</a>
    <hr class="border-gray-300 my-4">
    <a id="auth-link" href="#" class="text-red-600 hover:text-red-500 text-left">Sign Out</a>
  </nav>
</div>

    <!-- Modal for posting a job -->
    <div id="post-job-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl p-8 w-full modal relative">
            <!-- Modal Header -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Post a Job</h2>
                    <p class="text-gray-500">Create a new job opportunity for people to apply to.</p>
                </div>
                <button id="close-post-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Modal Content (Job Post Form) -->
            <form id="job-post-form">
                <!-- Company Logo & Name -->
                <div class="flex items-center space-x-4 mb-6">
                    <!-- Company Logo Upload -->
                    <div class="w-24 h-24 flex-shrink-0">
                        <div id="upload-logo-area" class="drag-and-drop-area w-full h-full rounded-2xl flex flex-col items-center justify-center text-center cursor-pointer transition-colors duration-200">
                            <img id="company-logo-preview" src="https://placehold.co/96x96/e2e8f0/94a3b8?text=Logo" alt="Company Logo" class="w-full h-full object-cover rounded-2xl hidden">
                            <i id="logo-upload-icon" class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-1"></i>
                            <p id="logo-upload-text" class="text-xs text-gray-500">Drag & drop or click</p>
                            <input type="file" id="logo-file-input" class="hidden" accept="image/*">
                        </div>
                    </div>
                    <!-- Company Name and Website -->
        <div class="flex-1 space-y-4">
                        <div>
                            <label for="company-name" class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                            <input type="text" id="company-name" placeholder="e.g. NextLens" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400">
                        </div>
                        <div>
                            <label for="website-link" class="block text-sm font-medium text-gray-700 mb-1">Website Link</label>
                            <input type="text" id="website-link" placeholder="e.g. https://www.nextlens.ai" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400">
                        </div>
                    </div>
                </div>

                <!-- Section: Job Basics -->
                <h3 class="text-lg font-semibold text-gray-800 mb-4">1. Job Basics</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="job-title" class="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
                        <input type="text" id="job-title" placeholder="e.g. Marketing Intern – AI Startups" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400">
                    </div>
                    <div>
                        <label for="post-position-type" class="block text-sm font-medium text-gray-700 mb-1">Position Type</label>
                        <select id="post-position-type" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                            <option value="Full-Time">Full-Time</option>
                            <option value="Part-Time">Part-Time</option>
                            <option value="Internship">Internship</option>
                            <option value="Freelance">Freelance</option>
                            <option value="Contract">Contract</option>
                        </select>
                    </div>
                    <div>
                        <label for="post-experience-level" class="block text-sm font-medium text-gray-700 mb-1">Experience Level</label>
                        <select id="post-experience-level" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                            <option value="Entry-Level">Entry-Level</option>
                            <option value="Mid-Level">Mid-Level</option>
                            <option value="Senior">Senior</option>
                            <option value="Executive">Executive</option>
                        </select>
                    </div>
                    <div>
                        <label for="post-industry" class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                        <!-- Options for this dropdown will be dynamically populated by JavaScript -->
                        <select id="post-industry" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                        </select>
                    </div>
                </div>

                <!-- Section: Job Details -->
                <h3 class="text-lg font-semibold text-gray-800 mb-4">2. Job Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="md:col-span-2">
                        <label for="job-description" class="block text-sm font-medium text-gray-700 mb-1">Job Description</label>
                        <!-- Auto-resizing textarea -->
                        <textarea id="job-description" rows="1" placeholder="Use bullet points, highlights, and clear sections to describe the role." class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 rich-text-editor placeholder-gray-400" style="resize: none;"></textarea>
                    </div>
                    <div class="md:col-span-2">
                        <label for="responsibilities" class="block text-sm font-medium text-gray-700 mb-1">Responsibilities</label>
                        <!-- Auto-resizing textarea -->
                        <textarea id="responsibilities" rows="1" placeholder="Clearly outline the main duties and expectations for this position." class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 rich-text-editor placeholder-gray-400" style="resize: none;"></textarea>
                    </div>
                    <div class="md:col-span-2">
                        <label for="post-location-type" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                        <select id="post-location-type" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black">
                            <option value="Remote">Remote</option>
                            <option value="On-site">On-site</option>
                            <option value="Hybrid">Hybrid</option>
                        </select>
                        <div id="post-location-input-container" class="relative mt-2 hidden">
                            <input type="text" id="post-location-input" placeholder="Country/City" class="w-full pl-4 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white placeholder-gray-400">
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label for="salary-compensation" class="block text-sm font-medium text-gray-700 mb-1">Salary / Compensation</label>
                        <div class="flex items-center space-x-2">
                            <input type="text" id="salary-compensation" placeholder="e.g. $20/hour" class="flex-1 p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400">
                            <label class="flex items-center cursor-pointer space-x-2 text-gray-700">
                                <input type="checkbox" id="negotiable-checkbox" class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                                <span>Negotiable</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Section: Requirements -->
                <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-4">3. Application Requirements</h3>
                <p class="text-gray-500 mb-4">Please list the required documents and materials applicants should submit to be considered for this position. This ensures a streamlined and efficient review process.</p>
                <div id="requirements-container" class="space-y-4 mb-4">
                    <!-- Dynamic requirement rows will be added here -->
                    <div class="requirement-box p-4 bg-gray-100 rounded-xl">
                        <div class="flex justify-end">
                            <button type="button" class="remove-requirement-btn text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Requirement Description</label>
                        <textarea rows="1" class="w-full p-2 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400 requirement-textarea" style="resize: none;"></textarea>
                        <label class="flex items-center cursor-pointer space-x-2 text-gray-700 mt-2">
                            <input type="checkbox" class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500 requirement-checkbox" checked>
                            <span>Required to submit with application</span>
                        </label>
                    </div>
                </div>
                <button type="button" id="add-requirement-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Add new requirement
                </button>

                <!-- Section: Application Instructions -->
                <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-4">4. Application Instructions</h3>
                <div class="space-y-4 mb-6">
                    <div>
                        <label for="how-to-apply" class="block text-sm font-medium text-gray-700 mb-1">How to Apply</label>
                        <p class="text-sm text-gray-500 mb-2">If you prefer another way of receiving applications, please describe it here. Otherwise, you'll be able to receive applications directly on our platform, view them, message the applicant, and schedule interviews all in one place.</p>
                        <!-- Auto-resizing textarea -->
                        <textarea id="how-to-apply" rows="1" placeholder="e.g. Email your resume to hiring@company.com" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400" style="resize: none;"></textarea>
                    </div>
                    <div>
                        <label for="application-deadline" class="block text-sm font-medium text-gray-700 mb-1">Application Deadline</label>
                        <input type="date" id="application-deadline" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 text-gray-700">
                    </div>
                    <div>
                        <label for="max-applicants" class="block text-sm font-medium text-gray-700 mb-1">Max Applicants / Spots (Optional)</label>
                        <input type="number" id="max-applicants" placeholder="e.g. 50" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400">
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="notify-checkbox" class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        <label for="notify-checkbox" class="text-sm font-medium text-gray-700 cursor-pointer">Notify me when a candidate applies</label>
                    </div>
                </div>

                <!-- Modal Actions -->
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="reset" id="reset-form-btn" class="px-6 py-3 text-white bg-red-500 rounded-xl font-medium shadow-lg hover:bg-red-600 transition-colors">
                        Reset Data
                    </button>
                    <button type="submit" id="post-job-submit-btn" class="px-6 py-3 text-white bg-blue-600 rounded-xl font-medium shadow-lg hover:bg-blue-700 transform hover:scale-105 transition-all">
                        Publish
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for viewing a job details -->
    <div id="job-details-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl p-8 w-full modal relative">
            <button id="close-details-modal-btn" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <div id="job-details-content" class="overflow-y-auto">
                <!-- Job details will be dynamically injected here -->
            </div>
            <div class="mt-6 flex justify-end">
                <button id="details-apply-btn" class="px-6 py-3 text-white bg-blue-500 rounded-xl font-medium shadow-md hover:bg-blue-600 transition-colors">
                    Apply Now
                </button>
            </div>
        </div>
    </div>

    <!-- New: Modal for submitting an application -->
    <div id="application-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl p-8 w-full modal relative">
            <button id="close-application-modal-btn" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <div id="application-modal-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Submit Your Application</h2>
                <p class="text-gray-500 mb-6">Please upload the required documents for this role.</p>
                <!-- Dynamic upload fields will be injected here -->
                <div id="application-requirements-upload-container" class="space-y-4 mb-6">
                    <!-- Dynamic upload sections generated by JavaScript -->
                </div>
                <div class="flex justify-end space-x-4">
                    <button id="cancel-application-btn" class="px-6 py-3 text-white bg-red-500 rounded-xl font-medium shadow-lg hover:bg-red-600 transition-colors">
                        Cancel
                    </button>
                    <button id="submit-application-btn" class="px-6 py-3 text-white bg-blue-600 rounded-xl font-medium shadow-lg hover:bg-blue-700 transform hover:scale-105 transition-all">
                        Submit Application
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- New: Modal for incomplete profile -->
    <div id="profile-required-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full text-center relative">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Profile Incomplete</h3>
            <p class="text-gray-600 mb-6">Please complete your profile by adding your name and a profile picture in My Network before applying for jobs.</p>
            <button id="go-to-my-network-btn" class="w-full px-6 py-3 bg-blue-500 text-white rounded-lg font-medium shadow-md hover:bg-blue-600 transition-colors">
                Go to My Network
            </button>
        </div>
    </div>

    <!-- New: Modal for NextLens AI Beta Message -->
    <div id="nextlens-message-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full relative">
            <button id="close-nextlens-message-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <div class="flex flex-col items-center">
                <h3 class="text-xl font-bold text-gray-800 mb-4">NextLens AI</h3>
                <p class="text-gray-600 mb-6 text-center">
                    Our AI works by analyzing job listings to match you with the right opportunities. Since we’re still in beta and building our listings, this feature isn’t available yet.
                </p>
            </div>
        </div>
    </div>

    <!-- New: Modal for Pricing Plans Beta Message -->
    <div id="pricing-plans-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full relative">
            <button id="close-pricing-plans-modal-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <div class="flex flex-col items-center text-center">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Pricing Plans</h3>
                <p class="text-gray-600 mb-6">
                    NextLens AI is currently in beta. During this phase, all features are free to use.
                </p>
            </div>
        </div>
    </div>


    <!-- Custom Message Box Modal -->
    <div id="message-box" class="fixed inset-0 z-[100] flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full relative">
            <button id="close-message-modal-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <div id="message-box-icon" class="text-4xl text-blue-500 mb-4 text-center">
                <i class="fas fa-info-circle"></i>
            </div>
            <div id="message-box-content" class="text-center text-gray-700">
                <!-- Message content will be injected here -->
            </div>
            <div class="flex justify-center mt-4">
                <button id="message-box-ok-btn" class="px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors">OK</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-auto">
        <div class="container mx-auto px-4 max-w-7xl">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Company Info -->
                <div>
                    <h3 class="text-2xl font-bold mb-2">NextLens AI</h3>
                    <p class="text-gray-400">The next generation of career building and recruitment, bringing clarity and focus so companies see talent clearly and talents find the right opportunities.</p>
                </div>
                <!-- Quick Links -->
                <div>
                    <h3 class="text-xl font-semibold mb-2">Quick Links</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="privacy.html" class="hover:text-white">Privacy & Policy</a></li>
                        <li><a href="contact.html" class="hover:text-white">Contact</a></li>
                    </ul>
                </div>
            </div>
            <hr class="border-gray-700 my-8">
            <div class="text-center text-sm text-gray-500">
                &copy; 2025 NextLens AI. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // --- Hamburger Menu Script (EXACT copy from index.html) ---
        document.addEventListener('DOMContentLoaded', () => {
            // Elements for the hamburger menu
            const openMenuBtn = document.getElementById('open-hamburger-menu-btn');
            const closeMenuBtn = document.getElementById('close-hamburger-menu-btn');
            const hamburgerMenu = document.getElementById('hamburger-menu-links');

            if (openMenuBtn && closeMenuBtn && hamburgerMenu) {
                // Toggle hamburger menu
                openMenuBtn.addEventListener('click', () => {
                    hamburgerMenu.classList.remove('closed');
                });
                closeMenuBtn.addEventListener('click', () => {
                    hamburgerMenu.classList.add('closed');
                });

                // Close menu when clicking outside of it
                document.addEventListener('click', (event) => {
                    // Check if the click is outside the menu and not on the open button
                    if (!hamburgerMenu.contains(event.target) && !openMenuBtn.contains(event.target)) {
                        hamburgerMenu.classList.add('closed');
                    }
                });
            }
            
            // === UNIVERSAL SIGN OUT FUNCTIONALITY ===
            function handleSignOut() {
                // Clear all authentication data
                localStorage.removeItem('token');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('email');
                localStorage.removeItem('userRole');
                localStorage.removeItem('userProfileName');
                localStorage.removeItem('userProfilePic');
                
                // Show success message
                showMessageBox('You have been signed out successfully.', 'info');
                
                // Redirect to login page
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            }
            
            // Sign out button logic
            const authLinks = document.querySelectorAll('#auth-link');
            authLinks.forEach(link => {
                if (link) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        handleSignOut();
                    });
                }
            });
        });

        // --- Authentication Check ---
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for our main auth check to complete, then configure UI
            setTimeout(() => {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    try {
                        const userData = JSON.parse(currentUser);
                        configureUIForRole(userData.role);
                    } catch (error) {
                        console.error('Error parsing user data:', error);
                    }
                }
            }, 100);
        });

        function configureUIForRole(userRole) {
            const postJobBtn = document.getElementById('post-job-btn');
            const postJobModal = document.getElementById('post-job-modal');
            

            if (userRole === 'company') {
                // Companies can post jobs but not apply to them
                if (postJobBtn) {
                    postJobBtn.style.display = 'block';
                    console.log('Showing post job button for company user');
                    // Mark the button as company user to be handled by existing event listener
                    postJobBtn.setAttribute('data-user-role', 'company');
                }

                // Hide apply buttons in job listings
                // Note: This part might need adjustment depending on when job cards are rendered
                const applyBtns = document.querySelectorAll('[id*="apply"], .apply-btn');
                applyBtns.forEach(btn => {
                    if (btn) btn.style.display = 'none';
                });
                
            } else if (userRole === 'talent') {
                // Talents can apply to jobs but cannot post them
                if (postJobBtn) {
                    postJobBtn.style.display = 'block';
                    console.log('Showing post job button for talent user with professional message');
                    
                    // Mark the button as talent user to be handled by existing event listener
                    postJobBtn.setAttribute('data-user-role', 'talent');
                }
                
                // Show apply buttons in job listings
                const applyBtns = document.querySelectorAll('[id*="apply"], .apply-btn');
                applyBtns.forEach(btn => {
                    if (btn) btn.style.display = 'block';
                });
            }
        }

        function checkTalentProfile() {
                    const currentUser = localStorage.getItem('currentUser');
                            if (!currentUser) {
                                        return false; // Not logged in
                                                }
                                                        try {
                                                                    const userData = JSON.parse(currentUser);
                                                                                // Assuming currentUser object includes 'name' and 'profilePic' fields from backend
                                                                                            // Check if name exists AND profilePic exists AND profilePic is not the placeholder URL
                                                                                                        return userData.name && userData.profilePic && !userData.profilePic.includes('placehold.co');
                                                                                                                } catch (error) {
                                                                                                                            console.error('Error parsing currentUser from localStorage during profile check:', error);
                                                                                                                                        return false; // Error parsing means profile is likely incomplete/corrupt
                                                                                                                                                }
                                                                                                                                                    }

                                                                                                                                                

        document.addEventListener('DOMContentLoaded', () => {

            // --- Global State & DOM Element Caching ---
            // Simulates a user profile state. Set to 'true' to simulate a completed profile.
            // You can change this to `true` to test the successful application flow.
            let isProfileComplete = false; 

            let currentJobId = null;
            let currentJobRequirements = [];
            let currentlyUploading = false;

            const postJobModal = document.getElementById('post-job-modal');
            const closePostModalBtn = document.getElementById('close-post-modal-btn');
            const postJobBtn = document.getElementById('post-job-btn');
            const jobDetailsModal = document.getElementById('job-details-modal');
            const closeDetailsModalBtn = document.getElementById('close-details-modal-btn');
            const detailsApplyBtn = document.getElementById('details-apply-btn');
            const jobListingsContainer = document.getElementById('job-listings');
            const jobDetailsContent = document.getElementById('job-details-content');

            const applicationModal = document.getElementById('application-modal');
            const closeApplicationModalBtn = document.getElementById('close-application-modal-btn');
            const cancelApplicationBtn = document.getElementById('cancel-application-btn');
            const submitApplicationBtn = document.getElementById('submit-application-btn');
            const applicationRequirementsUploadContainer = document.getElementById('application-requirements-upload-container');

            const openHamburgerMenuBtn = document.getElementById('open-hamburger-menu-btn');
            const closeHamburgerMenuBtn = document.getElementById('close-hamburger-menu-btn');
            const hamburgerMenu = document.getElementById('hamburger-menu-links');
            
            // Check for missing elements and log warnings
            if (!openHamburgerMenuBtn) console.warn('open-hamburger-menu-btn not found');
            if (!closeHamburgerMenuBtn) console.warn('close-hamburger-menu-btn not found');
            if (!hamburgerMenu) console.warn('hamburger-menu-links not found');
            
            // New modal and button for the profile check
            const profileRequiredModal = document.getElementById('profile-required-modal');
            const goToMyNetworkBtn = document.getElementById('go-to-my-network-btn');

            // New modal for the NextLens AI message
            const nextLensAiLink = document.getElementById('nextlens-ai-link');
            const nextLensMessageModal = document.getElementById('nextlens-message-modal');
            const closeNextLensMessageBtn = document.getElementById('close-nextlens-message-btn');

            // New modal for pricing plans message
            const pricingPlansLink = document.getElementById('pricing-plans-link');
            const pricingPlansModal = document.getElementById('pricing-plans-modal');
            const closePricingPlansModalBtn = document.getElementById('close-pricing-plans-modal-btn');

            const messageBox = document.getElementById('message-box');
            const closeMessageBoxBtn = document.getElementById('close-message-modal-btn');
            const messageBoxOkBtn = document.getElementById('message-box-ok-btn');
            const messageBoxContent = document.getElementById('message-box-content');
            const messageBoxIcon = document.getElementById('message-box-icon');
            
            const signOutBtn = document.getElementById('sign-out-btn');
            const cancelPlanBtn = document.getElementById('cancel-plan-btn');

            // Filter inputs and buttons
            const jobTitleInput = document.getElementById('job-title-input');
            const locationTypeDropdown = document.getElementById('location-type-dropdown');
            const locationInputContainer = document.getElementById('location-input-container');
            const locationInput = document.getElementById('location-input');
            const salaryInput = document.getElementById('salary-input');
            const positionTypeDropdown = document.getElementById('position-type-dropdown');
            const experienceLevelDropdown = document.getElementById('experience-level-dropdown');
            const industryDropdown = document.getElementById('industry-dropdown');

            const searchBtn = document.getElementById('search-btn');
            const resetBtn = document.getElementById('reset-btn');

            // Post job modal elements
            const postIndustryDropdown = document.getElementById('post-industry');
            const postLocationTypeDropdown = document.getElementById('post-location-type');
            const postLocationInputContainer = document.getElementById('post-location-input-container');
            const requirementsContainer = document.getElementById('requirements-container');
            const addRequirementBtn = document.getElementById('add-requirement-btn');

            const uploadLogoArea = document.getElementById('upload-logo-area');
            const logoFileInput = document.getElementById('logo-file-input');
            const companyLogoPreview = document.getElementById('company-logo-preview');
            const logoUploadIcon = document.getElementById('logo-upload-icon');
            const logoUploadText = document.getElementById('logo-upload-text');

            // --- Dummy Data (Reduced to two jobs) ---
            // Real jobs data from backend
            let allJobs = [];

            // Load jobs from backend
            async function loadJobs() {
                try {
                    const response = await fetch('/api/jobs');
                    if (response.ok) {
                        allJobs = await response.json();
                        console.log('Loaded jobs:', allJobs);
                        renderJobs(sortJobsByDate(allJobs));
                    } else {
                        console.error('Failed to load jobs:', response.status);
                        allJobs = [];
                    }
                } catch (error) {
                    console.error('Error loading jobs:', error);
                    allJobs = [];
                }
            }
        
            // Demo data removed - using real backend data instead

            // --- Helper Functions ---
            function showModal(modal) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.add('flex'), 10);
            }

            function hideModal(modal) {
                modal.classList.remove('flex');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }

            function showMessageBox(message, type = 'info') {
                let iconClass = '';
                let iconColor = '';
                switch (type) {
                    case 'success':
                        iconClass = 'fas fa-check-circle';
                        iconColor = 'text-green-500';
                        break;
                    case 'error':
                        iconClass = 'fas fa-exclamation-triangle';
                        iconColor = 'text-red-500';
                        break;
                    case 'info':
                    default:
                        iconClass = 'fas fa-info-circle';
                        iconColor = 'text-blue-500';
                        break;
                }
                messageBoxIcon.innerHTML = `<i class="${iconClass} ${iconColor}"></i>`;
                messageBoxContent.innerText = message;
                showModal(messageBox);
            }

            function hideMessageBox() {
                hideModal(messageBox);
            }

            // New function to show the profile required modal
            function showProfileRequiredModal() {
                showModal(profileRequiredModal);
            }

            // New function to show the NextLens AI message modal
            function showNextLensMessageModal() {
                showModal(nextLensMessageModal);
            }

            // New function to show the Pricing Plans message modal
            function showPricingPlansModal() {
                showModal(pricingPlansModal);
            }

            function sortJobsByDate(jobs) {
                return jobs.sort((a, b) => new Date(b.postedDate) - new Date(a.postedDate));
            }
        
            // Function to populate the post job industry dropdown
            function populateIndustryDropdown() {
                const industryOptions = industryDropdown.options;
                postIndustryDropdown.innerHTML = '';
                for (let i = 1; i < industryOptions.length; i++) {
                    const option = industryOptions[i];
                    const newOption = document.createElement('option');
                    newOption.value = option.value;
                    newOption.text = option.text;
                    postIndustryDropdown.appendChild(newOption);
                }
            }
        

            // Function to handle location input visibility
            function handleLocationInput(dropdown, inputContainer) {
                if (dropdown.value === 'On-site' || dropdown.value === 'Hybrid') {
                
inputContainer.classList.remove('hidden');
                } else {
                    inputContainer.classList.add('hidden');
                }
            }
        
            // Function to add a new requirement field to the post job modal
            function addNewRequirement() {
 const newRequirementHtml = `
        <div class="requirement-box p-4 bg-gray-100 rounded-xl">
 <div class="flex justify-end">
 <button type="button" class="remove-requirement-btn text-gray-400 hover:text-gray-600 transition-colors">
<i class="fas fa-times"></i>
 </button>
      </div>
  <label class="block text-sm font-medium text-gray-700 mb-1">Requirement Description</label>
<textarea rows="1" class="w-full p-2 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 placeholder-gray-400 requirement-textarea" style="resize: none;"></textarea>
            <div class="flex items-center justify-between mt-2">
 <label class="flex items-center cursor-pointer space-x-2 text-gray-700">
 <input type="checkbox" class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500 requirement-checkbox", checked>
 <span>Required to submit</span>
 </label>
                     <div>
          <label class="block text-sm font-medium text-gray-700">Input Type:</label>
 <select class="w-full p-2 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 bg-white text-black text-sm requirement-type-select">
 <option value="File Upload">File Upload</option>,
 <option value="Text Input">Text Input</option>,
 </select>,
 </div>
              </div>
  </div>
  `;
  requirementsContainer.insertAdjacentHTML('beforeend', newRequirementHtml);
const newTextarea = requirementsContainer.lastElementChild.querySelector('.requirement-textarea');
 autoResizeTextarea(newTextarea);
}
            }

            ,function renderJobs(jobs) {
                jobListingsContainer.innerHTML = '';
                if (jobs.length === 0) {
                    jobListingsContainer.innerHTML = '<p class="text-center text-gray-500 mt-8">No jobs found matching your criteria.</p>';
                    return;
                }
                jobs.forEach(job => {
                    const jobCard = document.createElement('div');
                    jobCard.className = 'bg-white/40 backdrop-blur-md rounded-2xl border border-gray-200 p-6 shadow-lg hover:shadow-xl transition-all cursor-pointer';
 jobCard.setAttribute('data-job-id', job.id),
                    jobCard.innerHTML = `
                        <div class="flex items-start justify-between space-x-4 mb-4">
                            <div class="flex-1 flex items-start space-x-4",>
                                <img src="${job.logoUrl}" alt="${job.companyName} logo" class="w-16 h-16 rounded-lg object-contain bg-white p-1 shadow-md flex-shrink-0">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">${job.jobTitle}</h3>
                                    <p class="text-sm text-blue-600 font-medium">${job.companyName}</p>
                                    <span class="text-xs text-gray-500">${timeSince(new Date(job.postedDate))} ago</span>
                                </div>
                            </div>
                            <button class="px-4 py-2 text-white bg-blue-500 rounded-xl font-medium shadow-md hover:bg-blue-600 transition-colors apply-btn" data-job-id="${job.id}">
                                Apply Now
                            </button>
                        </div>
                        <div class="flex flex-wrap items-center gap-2 mb-4">
                            <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.positionType}</span>
                            <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.locationType}</span>
                            <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.experienceLevel}</span>
                            <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.salary}</span>
                        </div>
                        <p class="text-gray-600 mb-4 line-clamp-2">${job.description}</p>
                        <div class="flex justify-between items-center">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-briefcase"></i> ${job.industry}
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-map-marker-alt"></i> ${job.location || 'N/A'}
                            </div>
                        </div>
                    `;
                    jobCard.addEventListener('click', (e) => {
                        if (!e.target.closest('.apply-btn')) {
                           showJobDetails(job.id);
                        }
                    });
                    jobListingsContainer.appendChild(jobCard);
                });
            }

            // New filtering function
            ,function filterJobs() {
                const jobTitle = jobTitleInput.value.toLowerCase();
                const locationType = locationTypeDropdown.value;
                const location = locationInput.value.toLowerCase();
                const salary = salaryInput.value.toLowerCase();
                const positionType = positionTypeDropdown.value;
                const experienceLevel = experienceLevelDropdown.value;
                const industry = industryDropdown.value;

                const filteredJobs = allJobs.filter(job => {
                    const matchesTitle = job.jobTitle.toLowerCase().includes(jobTitle) || job.companyName.toLowerCase().includes(jobTitle);
                    const matchesLocationType = !locationType || job.locationType === locationType;
                    const matchesLocation = !location || job.location.toLowerCase().includes(location);
                    const matchesSalary = !salary || job.salary.toLowerCase().includes(salary);
                    const matchesPositionType = !positionType || job.positionType === positionType;
                    const matchesExperienceLevel = !experienceLevel || job.experienceLevel === experienceLevel;
                    const matchesIndustry = !industry || job.industry === industry;

                    // All conditions must be true for the job to be included
                    return matchesTitle && matchesLocationType && matchesLocation && matchesSalary && matchesPositionType && matchesExperienceLevel && matchesIndustry;
                });

                renderJobs(sortJobsByDate(filteredJobs));
            }

            // Function to reset all filters
            ,function resetFilters() {
                jobTitleInput.value = '';
                locationTypeDropdown.value = '';
                locationInput.value = '';
                salaryInput.value = '';
                positionTypeDropdown.value = '';
                experienceLevelDropdown.value = '';
                industryDropdown.value = '';
                locationInputContainer.classList.add('hidden');
                renderJobs(sortJobsByDate(allJobs));
            }


            ,function timeSince(date) {
                const seconds = Math.floor((new Date() - date) / 1000);
                let interval = seconds / 31536000;
                if (interval > 1) return Math.floor(interval) + " year(s)";
                interval = seconds / 2592000;
                if (interval > 1) return Math.floor(interval) + " month(s)";
                interval = seconds / 86400;
                if (interval > 1) return Math.floor(interval) + " hour(s)";
                interval = seconds / 3600;
                if (interval > 1) return Math.floor(interval) + " hour(s)";
                interval = seconds / 60;
                if (interval > 1) return Math.floor(interval) + " minute(s)";
                return Math.floor(seconds) + " second(s)";
            }

            ,function showJobDetails(jobId) {
                const job = allJobs.find(j => j.id === jobId);
                if (!job) return;

                currentJobId = jobId;
                currentJobRequirements = job.requirements || [];

                jobDetailsContent.innerHTML = `
                    <div class="flex items-start space-x-6 mb-6",>
                        <img src="${job.logoUrl}" alt="${job.companyName} logo" class="w-24 h-24 rounded-2xl object-contain bg-white p-1 shadow-md flex-shrink-0">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800">${job.jobTitle}</h2>
                            <p class="text-xl text-blue-600 font-medium">${job.companyName}</p>
                            <div class="flex flex-wrap items-center gap-2 mt-2">
                                <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.positionType}</span>
                                <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.locationType}</span>
                                <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.experienceLevel}</span>
                                <span class="text-sm text-gray-700 font-medium bg-gray-200 rounded-full px-3 py-1">${job.salary}</span>
                            </div>
                        </div>
                    </div>
<!-- Job description -->
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Job Description</h3>
                    <p class="text-gray-600 mb-6">${job.description}</p>

                    <!-- Responsibilities -->
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Responsibilities</h3>
                    <ul class="list-disc list-inside text-gray-600 space-y-2 mb-6">
                        ${job.responsibilities.map(r => `<li>${r}</li>`).join('')}
                    </ul>

                    <!-- How to apply -->
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">How to Apply</h3>
                    <p class="text-gray-600 mb-6">${job.howToApply || "Apply directly through our platform."}</p>

                    <!-- Requirements -->
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Requirements</h3>
                    <div class="text-gray-600 mb-6 space-y-2">
                        ${job.requirements.length > 0 ? job.requirements.map(req => `
                            <div class="p-2 bg-gray-100 rounded-lg">
                                <p class="text-sm">${req.description}</p>
                                <p class="text-xs text-blue-600 font-medium mt-1">
                                    ${req.required ? 'Required for application' : 'Optional'}
                                </p>
                            </div>
                        `).join('') : "No specific requirements listed."}
                    </div>
                `;

                if (job.howToApply) {
                    detailsApplyBtn.style.display = 'none';
                } else {
                    detailsApplyBtn.style.display = 'block';
                }

                showModal(jobDetailsModal);
            }
        
             ,function handleApplyClick(jobId) {
                        const currentUser = localStorage.getItem('currentUser');

                                // Check if user is authenticated
                                        if (!currentUser) {
                                                    showMessageBox('Please log in to apply for jobs.', 'info');
                                                                setTimeout(() => {
                                                                                window.location.href = '/login.html';
                                                                                            }, 1500); // Reduced delay
                                                                                                        return;
                                                                                                                }

                                                                                                                        let userData;
                                                                                                                                try {
                                                                                                                                            userData = JSON.parse(currentUser);
                                                                                                                                                    } catch (error) {
                                                                                                                                                                console.error('Error parsing currentUser from localStorage:', error);
                                                                                                                                                                             showMessageBox('An error occurred while retrieving your user data. Please try logging in again.', 'error');
                                                                                                                                                                                          setTimeout(() => {
                                                                                                                                                                                                            window.location.href = '/login.html';
                                                                                                                                                                                                                         }, 1500);
                                                                                                                                                                                                                                     return;
                                                                                                                                                                                                                                             }

                                                                                                                                                                                                                                                     // Strict check if user is a company (companies cannot apply)
                                                                                                                                                                                                                                                             if (userData.role === 'company') {
                                                                                                                                                                                                                                                                         showMessageBox('Companies cannot apply for jobs. You can only post jobs.', 'error');
                                                                                                                                                                                                                                                                                     return; // Stop execution if a company user
                                                                                                                                                                                                                                                                                             }

                                                                                                                                                                                                                                                                                                     // Check if talent user has completed their profile (for talent role only)
                                                                                                                                                                                                                                                                                                             const isProfileComplete = checkTalentProfile(); // Use the updated checkTalentProfile function

                                                                                                                                                                                                                                                                                                                     if (userData.role === 'talent' && !isProfileComplete) {
                                                                                                                                                                                                                                                                                                                                 showProfileRequiredModal(); // Show the profile required modal
                                                                                                                                                                                                                                                                                                                                             return; // Stop execution if profile is incomplete
                                                                                                                                                                                                                                                                                                                                                     }


                                                                                                                                                                                                                                                                                                                                                             const job = allJobs.find(j => j.id === jobId);
                                                                                                                                                                                                                                                                                                                                                                     if (!job) {
                                                                                                                                                                                                                                                                                                                                                                                 console.error('Job not found with ID:', jobId);
                                                                                                                                                                                                                                                                                                                                                                                             showMessageBox('Selected job not found.', 'error');
                                                                                                                                                                                                                                                                                                                                                                                                         return;
                                                                                                                                                                                                                                                                                                                                                                                                                 }

                                                                                                                                                                                                                                                                                                                                                                                                                         currentJobId = jobId;
                                                                                                                                                                                                                                                                                                                                                                                                                                 // Ensure job.requirements is an array, default to empty if null/undefined
                                                                                                                                                                                                                                                                                                                                                                                                                                         currentJobRequirements = Array.isArray(job.requirements) ? job.requirements : [];


                                                                                                                                                                                                                                                                                                                                                                                                                                                 const requiredItems = currentJobRequirements.filter(req => req.required);

                                                                                                                                                                                                                                                                                                                                                                                                                                                         // If there are no required items, show a simple confirmation/success and potentially submit a minimal application
                                                                                                                                                                                                                                                                                                                                                                                                                                                                 if (requiredItems.length === 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                             // In a real application, you'd send a minimal application request to the backend here
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         // For now, we'll just show a success message as if it was submitted.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      showMessageBox("Your application has been submitted successfully! We will contact you soon.", 'success');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   // You might want to add backend call here: submitApplication(true); // true indicates no required files/inputs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               // Populate the application modal with dynamic inputs based on required items
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       applicationRequirementsUploadContainer.innerHTML = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               requiredItems.forEach((req, index) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           const inputContainerDiv = document.createElement('div'); // Use a container for each input block
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       inputContainerDiv.className = 'flex flex-col space-y-2';

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   let inputHtml = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               const inputId = `application-req-${index}`; // Unique ID for each input element

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           if (req.type === 'File Upload') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           inputHtml = `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <label for="${inputId}" class="text-gray-700 font-medium">${req.description}</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <div class="drag-and-drop-area w-full p-6 rounded-xl text-center cursor-pointer transition-colors duration-200 border border-gray-300 hover:border-blue-500" data-requirement="${req.description}">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <input type="file" id="${inputId}" class="hidden file-upload-input" data-requirement="${req.description}" accept=".pdf, .doc, .docx, image/*">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   <p class="text-sm text-gray-500"><i class="fas fa-cloud-upload-alt mr-2 text-xl text-gray-400"></i><br>Drag & drop or click to upload</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <p class="text-sm text-gray-500 mt-2 file-name hidden"></p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               `;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           } else if (req.type === 'Text Input') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            inputHtml = `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <label for="${inputId}" class="text-gray-700 font-medium">${req.description}</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <input type="text" id="${inputId}" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 application-text-input" placeholder="Enter ${req.description}">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     `;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // Default to Text Input or handle unknown types
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   console.warn(`Unknown requirement type: ${req.type}. Defaulting to Text Input for "${req.description}".`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     inputHtml = `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <label for="${inputId}" class="text-gray-700 font-medium">${req.description}</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <input type="text" id="${inputId}" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 application-text-input" placeholder="Enter ${req.description}">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              `;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      inputContainerDiv.innerHTML = inputHtml;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  applicationRequirementsUploadContainer.appendChild(inputContainerDiv);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // Add event listeners for drag and drop if it's a file upload area
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           if (req.type === 'File Upload') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const area = inputContainerDiv.querySelector('.drag-and-drop-area');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             const fileInput = area.querySelector('.file-upload-input');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const fileNameSpan = area.querySelector('.file-name');

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               area.addEventListener('click', () => fileInput.click());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                area.addEventListener('dragover', (e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          area.classList.add('drag-over');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            area.addEventListener('dragleave', () => area.classList.remove('drag-over'));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             area.addEventListener('drop', (e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       area.classList.remove('drag-over');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const files = e.dataTransfer.files;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 if (files.length > 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fileInput.files = files;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   fileNameSpan.textContent = files[0].name;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            fileNameSpan.classList.remove('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   fileInput.addEventListener('change', () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (fileInput.files.length > 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 fileNameSpan.textContent = fileInput.files[0].name;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fileNameSpan.classList.remove('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Clear file name if input is cleared
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fileNameSpan.textContent = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            fileNameSpan.classList.add('hidden');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               // Show the application modal only if there are required items
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       if (requiredItems.length > 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    showModal(applicationModal);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         // This case should ideally be handled by the check at the start of the function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      console.warn("handleApplyClick called but no required items to display modal.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },
        

            async function submitApplication() { // Made the function async
                        if (currentlyUploading) return;
                        
                                const requiredInputs = applicationRequirementsUploadContainer.querySelectorAll('.file-upload-input, .application-text-input');
                                        const formData = new FormData();
                                                let allRequiredMet = true; // Flag to check if all required inputs have values
                                                
                                                        // Append job ID
                                                                if (currentJobId) {
                                                                            formData.append('jobId', currentJobId);
                                                                                    } else {
                                                                                                console.error('No current job ID found for application.');
                                                                                                            showMessageBox('Error submitting application: Job ID missing.', 'error');
                                                                                                                        return;
                                                                                                                                }

                                                                                                                                        // Collect data from dynamic inputs
                                                                                                                                                requiredInputs.forEach(input => {
                                                                                                                                                            // Use the label associated with the input by its 'for' attribute
                                                                                                                                                                        const labelElement = input.closest('.flex-col.space-y-2').querySelector('label');
                                                                                                                                                                                    const requirementDescription = labelElement ? labelElement.textContent.trim() : (input.dataset.requirement || 'Unknown Requirement'); // Fallback

                                                                                                                                                                                                if (input.type === 'file') {
                                                                                                                                                                                                                if (input.files.length === 0) {
                                                                                                                                                                                                                                    allRequiredMet = false;
                                                                                                                                                                                                                                                        // Do not append if no file
                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                            // Append the file. Use a consistent naming convention, e.g., 'requirement_File Upload_Description'
                                                                                                                                                                                                                                                                                                                 formData.append(`requirement_FileUpload_${requirementDescription}`, input.files[0]); // Append the file
                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                             } else if (input.type === 'text') {
                                                                                                                                                                                                                                                                                                                                                              if (!input.value.trim()) {
                                                                                                                                                                                                                                                                                                                                                                                  allRequiredMet = false;
                                                                                                                                                                                                                                                                                                                                                                                                   }
                                                                                                                                                                                                                                                                                                                                                                                                                    // Append the text value. Use a consistent naming convention, e.g., 'requirement_TextInput_Description'
                                                                                                                                                                                                                                                                                                                                                                                                                                     formData.append(`requirement_TextInput_${requirementDescription}`, input.value.trim());
                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                         });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                 if (!allRequiredMet) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                             showMessageBox("Please provide all required information to submit your application.", 'error');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         const token = localStorage.getItem('token');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 if (!token) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             showMessageBox('Authentication token not found. Please log in again.', 'error');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          setTimeout(() => window.location.href = '/login.html', 1500);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // Disable button and show loading
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const submitApplicationBtn = document.getElementById('submit-application-btn'); // Re-get element
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      submitApplicationBtn.innerHTML = '<i class="fas fa-spinner fa-spin spinner-icon mr-2"></i> Submitting...';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              submitApplicationBtn.disabled = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      currentlyUploading = true;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const response = await fetch('/api/jobs/apply-job', { // Correct endpoint path
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          method: 'POST',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           headers: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Do NOT set Content-Type for FormData; browser does it
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     'Authorization': `Bearer ${token}` // Include the token
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      body: formData // Send FormData object
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const data = await response.json();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (response.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          showMessageBox('Your application has been submitted successfully!', 'success');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          hideModal(applicationModal);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Reset application modal inputs if needed (optional)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       console.error('Failed to submit application:', data.error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        showMessageBox(`Failed to submit application: ${data.error || 'Unknown error'}`, 'error');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        console.error('Error submitting application:', error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    showMessageBox('Network error. Please try again.', 'error');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } finally {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Re-enable button and restore text
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    submitApplicationBtn.innerHTML = 'Submit Application';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                submitApplicationBtn.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            currentlyUploading = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }



            ,function autoResizeTextarea(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = textarea.scrollHeight + 'px';
            }

            ,function handleLogoUpload(file) {
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        companyLogoPreview.src = e.target.result;
                        uploadLogoArea.classList.add('has-image');
                    };
                    reader.readAsDataURL(file);
                }
            }

            // --- Event Listeners ---
        // Post Job Button Listener
            // Add the event listener directly
 postJobBtn.addEventListener('click', () => {
                                                                                        if (!currentUser) {
                                                                                                            showMessageBox('Please log in to post jobs.', 'info'); setTimeout(() => {
                                                                                                                                    window.location.href = '/login.html';
                                                                                                                                                        }, 2000);
                                                                                                                                                                            return;
                                                                                                                                                                                            }

                                                                                                                                                                                                            let userData;
                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                userData = JSON.parse(currentUser);
                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                    showMessageBox('Please log in to post jobs.', 'info');
                                                                                                                                                                                                                                                                                                        setTimeout(() => {
                                                                                                                                                                                                                                                                                                                                window.location.href = '/login.html';
                                                                                                                                                                                                                                                                                                                                                    }, 2000);
                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                        if (userData.role !== 'company') {
                                                                                                                                                                                                                                                                                                                                                                                                                            showMessageBox('Job posting is exclusively available to company accounts. As a talent user, you can explore opportunities, apply to positions, and connect with employers. To post jobs, please create a company account.', 'info');
                                                                                                                                                                                                                                                                                                                                                                                                                                                return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                showModal(postJobModal);
 });

 if (closePostModalBtn) {
                closePostModalBtn.addEventListener('click', () => hideModal(postJobModal));
            }
            if (closeDetailsModalBtn) {
                closeDetailsModalBtn.addEventListener('click', () => hideModal(jobDetailsModal));
            }

            if (jobListingsContainer) {
                jobListingsContainer.addEventListener('click', (e) => {
                    const applyButton = e.target.closest('.apply-btn');
                    if (applyButton) {
                        const jobId = parseInt(applyButton.dataset.jobId);
                        handleApplyClick(jobId);
                    }
                });
            }

            if (detailsApplyBtn) {
                detailsApplyBtn.addEventListener('click', () => {
                    hideModal(jobDetailsModal);
                    handleApplyClick(currentJobId);
                });
            }

            if (closeApplicationModalBtn) {
                closeApplicationModalBtn.addEventListener('click', () => hideModal(applicationModal));
            }
            if (cancelApplicationBtn) {
                cancelApplicationBtn.addEventListener('click', () => hideModal(applicationModal));
            }
            if (submitApplicationBtn) {
                submitApplicationBtn.addEventListener('click', submitApplication);
            }

            if (closeMessageBoxBtn) {
                closeMessageBoxBtn.addEventListener('click', hideMessageBox);
            }
            if (messageBoxOkBtn) {
                messageBoxOkBtn.addEventListener('click', hideMessageBox);
            }
            
            // New event listener for the "Go to My Network" button
            if (goToMyNetworkBtn) {
                goToMyNetworkBtn.addEventListener('click', () => {
                    window.location.href = 'my-network.html';
                    hideModal(profileRequiredModal);
                });
            }
        
            // New event listener for the NextLens AI link
            if (nextLensAiLink) {
                nextLensAiLink.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent the default link behavior
                    showNextLensMessageModal();
                });
            }

            if (closeNextLensMessageBtn) {
                closeNextLensMessageBtn.addEventListener('click', () => hideModal(nextLensMessageModal));
            }

            // New event listener for the Pricing Plans link
            if (pricingPlansLink) {
                pricingPlansLink.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent the default link behavior
                    showPricingPlansModal();
                });
            }

            if (closePricingPlansModalBtn) {
                closePricingPlansModalBtn.addEventListener('click', () => hideModal(pricingPlansModal));
            }
                

            // Debug: Log element states
            console.log('Hamburger Debug:', {
                openHamburgerMenuBtn: !!openHamburgerMenuBtn,
                closeHamburgerMenuBtn: !!closeHamburgerMenuBtn,
                hamburgerMenu: !!hamburgerMenu
            });

            // Toggle hamburger menu - EXACT copy from index.html
            if (openHamburgerMenuBtn && closeHamburgerMenuBtn && hamburgerMenu) {
                console.log('All hamburger elements found, adding event listeners');
                
                openHamburgerMenuBtn.addEventListener('click', () => {
                    console.log('Open hamburger clicked, removing closed class');
                    hamburgerMenu.classList.remove('closed');
                });
                
                closeHamburgerMenuBtn.addEventListener('click', () => {
                    console.log('Close hamburger clicked, adding closed class');
                    hamburgerMenu.classList.add('closed');
                });

                // Close menu when clicking outside of it
                document.addEventListener('click', (event) => {
                    // Check if the click is outside the menu and not on the open button
                    if (!hamburgerMenu.contains(event.target) && !openHamburgerMenuBtn.contains(event.target)) {
                        hamburgerMenu.classList.add('closed');
                    }
                });
            } else {
                console.error('Missing hamburger elements:', {
                    openHamburgerMenuBtn: !!openHamburgerMenuBtn,
                    closeHamburgerMenuBtn: !!closeHamburgerMenuBtn,
                    hamburgerMenu: !!hamburgerMenu
                });
            }


            // Sign out button listener (avoid duplicate declaration)
            const jobSignOutBtn = document.getElementById('sign-out-btn');
            if (jobSignOutBtn) {
                jobSignOutBtn.addEventListener('click', () => {
                    // Clear new authentication system
                    localStorage.removeItem('token');
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('email');
                    localStorage.removeItem('userRole');
                    // Clear old system (just in case)
                    localStorage.removeItem('userToken');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userProfileName');
                    localStorage.removeItem('userProfilePic');
                    showMessageBox("You have been signed out.", 'info');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                    if (hamburgerMenu) {
                        hamburgerMenu.classList.remove('open');
                        hamburgerMenu.classList.add('closed');
                    }
                });
            }

            // Main filter location dropdown listener
            if (locationTypeDropdown) {
                locationTypeDropdown.addEventListener('change', () => handleLocationInput(locationTypeDropdown, locationInputContainer));
            }

            // Post a job location dropdown listener
            if (postLocationTypeDropdown) {
                postLocationTypeDropdown.addEventListener('change', () => handleLocationInput(postLocationTypeDropdown, postLocationInputContainer));
            }

            // New requirement functionality
            if (addRequirementBtn) {
                addRequirementBtn.addEventListener('click', addNewRequirement);
            }
            if (requirementsContainer) {
                requirementsContainer.addEventListener('click', (e) => {
                    if (e.target.closest('.remove-requirement-btn')) {
                        e.target.closest('.requirement-box').remove();
                    }
                });
                requirementsContainer.addEventListener('input', (e) => {
                    if (e.target.classList.contains('requirement-textarea')) {
                        autoResizeTextarea(e.target);
                    }
                });
            }

            const textareas = [
                document.getElementById('job-description'),
                document.getElementById('responsibilities'),
                document.getElementById('how-to-apply')
            ].filter(Boolean); // Remove null elements
            textareas.forEach(textarea => {
                if (textarea) {
                    textarea.addEventListener('input', () => autoResizeTextarea(textarea));
                    autoResizeTextarea(textarea);
                }
            });

            // Logo Upload Event Listeners
            if (uploadLogoArea && logoFileInput) {
                uploadLogoArea.addEventListener('click', () => logoFileInput.click());
                logoFileInput.addEventListener('change', (e) => handleLogoUpload(e.target.files[0]));

                uploadLogoArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    uploadLogoArea.classList.add('drag-over');
                });
                uploadLogoArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    uploadLogoArea.classList.remove('drag-over');
                });
                uploadLogoArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    uploadLogoArea.classList.remove('drag-over');
                    const file = e.dataTransfer.files[0];
                    handleLogoUpload(file);
                });
            }

      const jobPostForm = document.getElementById('job-post-form');
          if (jobPostForm) {
                  jobPostForm.addEventListener('submit', async (e) => { // Make the event listener handler async
                              e.preventDefault();

                                          // Basic validation
                                                      const jobTitle = document.getElementById('job-title').value.trim();
                                                                  const companyName = document.getElementById('company-name').value.trim();
                                                                              const description = document.getElementById('job-description').value.trim();
                                                                                          const responsibilitiesText = document.getElementById('responsibilities').value.trim();


                                                                                                      if (!jobTitle || !companyName || !description) {
                                                                                                                      showMessageBox('Please fill in all required fields (Job Title, Company Name, and Description).', 'error');
                                                                                                                                      return;
                                                                                                                                                  }

                                                                                                                                                              // Collect requirements with types
                                                                                                                                                                          const requirements = [];
                                                                                                                                                                                      const requirementBoxes = requirementsContainer.querySelectorAll('.requirement-box');
                                                                                                                                                                                                  requirementBoxes.forEach(box => {
                                                                                                                                                                                                                  const desc = box.querySelector('.requirement-textarea').value.trim();
                                                                                                                                                                                                                                  const required = box.querySelector('.requirement-checkbox').checked;
                                                                                                                                                                                                                                                  const type = box.querySelector('.requirement-type-select').value; // Get the selected type
                                                                                                                                                                                                                                                                  if (desc) {
                                                                                                                                                                                                                                                                                      requirements.push({ description: desc, required: required, type: type });
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                  });

                                                                                                                                                                                                                                                                                                                              const token = localStorage.getItem('token');
                                                                                                                                                                                                                                                                                                                                          if (!token) {
                                                                                                                                                                                                                                                                                                                                                          showMessageBox('Authentication token not found. Please log in again.', 'error');
                                                                                                                                                                                                                                                                                                                                                                          setTimeout(() => window.location.href = '/login.html', 1500);
                                                                                                                                                                                                                                                                                                                                                                                          return;
                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                  // Use FormData for file and text data
                                                                                                                                                                                                                                                                                                                                                                                                                              const formData = new FormData();
                                                                                                                                                                                                                                                                                                                                                                                                                                          formData.append('companyName', companyName);
                                                                                                                                                                                                                                                                                                                                                                                                                                                      formData.append('websiteLink', document.getElementById('website-link').value.trim());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  formData.append('jobTitle', jobTitle);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              formData.append('positionType', document.getElementById('post-position-type').value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          formData.append('experienceLevel', document.getElementById('post-experience-level').value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      formData.append('industry', document.getElementById('post-industry').value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  formData.append('jobDescription', description);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              formData.append('responsibilities', responsibilitiesText); // Send as text, backend can split
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          formData.append('locationType', document.getElementById('post-location-type').value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      formData.append('locationInput', document.getElementById('post-location-input').value.trim());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  formData.append('salaryCompensation', document.getElementById('salary-compensation').value.trim());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              formData.append('negotiable', document.getElementById('negotiable-checkbox').checked);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          formData.append('howToApply', document.getElementById('how-to-apply').value.trim());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      formData.append('applicationDeadline', document.getElementById('application-deadline').value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  formData.append('maxApplicants', document.getElementById('max-applicants').value.trim());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              formData.append('notifyMe', document.getElementById('notify-checkbox').checked);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Append requirements as a string (backend will need to parse this JSON string)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      formData.append('requirements', JSON.stringify(requirements));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // Append company logo file if selected
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const logoFile = document.getElementById('logo-file-input').files[0];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (logoFile) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          formData.append('companyLogo', logoFile); // 'companyLogo' should match the field name expected by multer in your backend
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // Disable button and show loading
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const postJobSubmitBtn = document.getElementById('post-job-submit-btn');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           postJobSubmitBtn.innerHTML = '<i class="fas fa-spinner fa-spin spinner-icon mr-2"></i> Publishing...';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        postJobSubmitBtn.disabled = true;


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const response = await fetch('/api/jobs/post-job', { // Correct endpoint path
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        method: 'POST',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            headers: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     // Do NOT set Content-Type for FormData; browser does it
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              'Authorization': `Bearer ${token}` // Include the token
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      body: formData // Send FormData object
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const data = await response.json();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (response.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          showMessageBox('Job posted successfully!', 'success');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              hideModal(postJobModal);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  document.getElementById('job-post-form').reset(); // Reset the form
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // Reset logo preview
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const uploadLogoArea = document.getElementById('upload-logo-area'); // Re-get element
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const companyLogoPreview = document.getElementById('company-logo-preview'); // Re-get element
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  uploadLogoArea.classList.remove('has-image');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      companyLogoPreview.src = 'https://placehold.co/96x96/e2e8f0/94a3b8?text=Logo';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Remove dynamic requirements and add one default back
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              requirementsContainer.innerHTML = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  addNewRequirement(); // Add one default requirement back


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // Reload jobs to show the new posting
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await loadJobs();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               console.error('Failed to post job:', data.error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   showMessageBox(`Failed to post job: ${data.error || 'Unknown error'}`, 'error');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               console.error('Error posting job:', error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               showMessageBox('Network error. Please try again.', 'error');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           } finally {
 // Re-enable button and restore text
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            postJobSubmitBtn.innerHTML = 'Publish';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            postJobSubmitBtn.disabled = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    </script>

<script>
  const openMenuBtn = document.getElementById('open-hamburger-menu-btn');
  const closeMenuBtn = document.getElementById('close-hamburger-menu-btn');
  const hamburgerMenu = document.getElementById('hamburger-menu-links');

  // Open and close menu
  openMenuBtn.addEventListener('click', () => {
    hamburgerMenu.classList.remove('closed');
  });
  closeMenuBtn.addEventListener('click', () => {
    hamburgerMenu.classList.add('closed');
  });

  // Optional: close menu if user clicks outside
  document.addEventListener('click', (e) => {
    if (!hamburgerMenu.contains(e.target) && !openMenuBtn.contains(e.target)) {
      hamburgerMenu.classList.add('closed');
    }
  });

</script>
</body>
</html>

